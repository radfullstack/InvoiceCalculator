<!DOCTYPE html>
<html lang="en">
<head>
    <script type="text/javascript">
    // Dropping some vars at the top for editing convinience

        // Setting up an Engineer (Estimated by on the invoice)
        engineer = "Radoslaw Radecki";
        
        // Subscriptions & Prices
        subscriptions = [
            ["Microsoft 365 Basic for Business", 5.1],
            ["Microsoft 365 Apps for Business", 8.8],
            ["Microsoft 365 Standard for Business", 10.5],
            ["Microsoft 365 Premium for Business", 18.6]
        ];
    </script>
<!--
    Â©Author: Radoslaw Radecki
    Version: 0.2
    Collaboration: Katarzyna Bergier & Anna Wilczak
    For purposes of improving the efficiency of invoice calculation, before it gets generated by the system.
    This is due to demand for custom request of estimation, where multiple changes have been performed.
    TechStack:
     - Challange to achieve all with pure JS (no external libraries)
-->


    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Invoice Calculator</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css" integrity="sha512-KfkfwYDsLkIlwQp6LFnl8zNdLGxu9YAA1QvwINks4PhcElQSvqcyVLLD9aMhXd13uQjoXtEKNosOWaZqXgel0g==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <style>
        @page { size: A4; margin: 0; }
        html,body,.main {
            height:100%!important
        } 
        .main,.main>div,.main>div>div,.form-panel,.invoice {
            min-height: 100%!important;
        }
        .col label:first-letter {
            text-transform: uppercase
        }
        #form-panel {
            background: #363636;
            background-image: none;
            color:white;
        }
        .main.mstemplate #form-panel input,
        .main.mstemplate #form-panel select,
        .main.mstemplate #form-panel button {
            border-radius: 0!important;
        }
        #form-panel.d-none ~ div>#invoice>div, #form-panel.d-none ~ div>#invoice>div>div>div>div {
            margin: 0 auto!important;
            padding: 0!important;
            max-width: 100%;
        }
        .disclaimer {
            font-size: x-small;
        }
        .btn-primary {
            color: white;
            background: #0376cf;
            border-color: #0376cf;
        }
        .btn-primary:hover {
            color: #0376cf;
            background: white;
            border-color: #0376cf;
        }
        .btn-copyright {
            position: fixed;
            bottom: 20px;
            left: 20px;
            color: #fff;
            padding:20px 20px 20px 20px;
            background: none;
            -webkit-animation-duration: 1s;
            animation-duration: 1s; 
            -webkit-animation-fill-mode: both; 
            animation-fill-mode: both; 
        }
        .btn-copyright:hover {
            color: #0376cf!important;
        }
        .btn-remove {
            color: white;
            margin-top:24px;
            font-size:24px;
        }
        .btn-remove-change {
            font-size:15px;
            font-weight: bold;
            color:#0376cf;
            width: 35px;
            height: 35px;
            padding: 0 !important;
            border: 2px solid #0376cf;
        }
        .btn-remove-change:hover {
            color: white;
            border: 2px solid white;
        }
        .btn-remove:hover {
            color:#0376cf;
        }
        .btn-copyright i {
            font-size: 20px;
            display: block;
            height: 20px;
            width: 20px;
        }
        #add-subscription {
            color: white;
            border: 2px solid #0376cf;
        }
        #add-subscription:hover {
            border: 2px solid #fff
        }
        #copy-invoice {
            display: block;
            margin-left: auto;
            min-width:80px;
            transition: all .3s;
        }
    </style>
</head>
<body>
    <div class="main mstemplate">
        <div class="row m-0 p-0">
            <!-- FORM Column -->
            <div id="form-panel" class="col-sm-12 col-xl-7 p-5 pt-4">
                <h1 class="text-title-medium-70 mb-4 tool-title">
                    <i class="fa-brands fa-microsoft"></i> Invoice Calculator
                </h1>
                <main>
                    <p class="mb-2">Client info:</p>
                    <div class="col-6 ps-4 mb-4">
                        <label>Requested by:</label>
                        <input id="clientName" type="text" class="form-control" placeholder="John Appleseed">
                    </div>
                    
                    <p class="mb-2">Subscriptions:</p>
                    <!-- OL to append subscriptions -->
                    <ol id="SubList">
                    </ol>
                    <!-- Button to add subscriptions -->
                    <div class="d-flex justify-content-end">
                        <Button id="add-subscription" class="btn">Add Another Subscription</Button>
                    </div>
                    
                </main>
                <button type="button" id="copyright" class="btn btn-copyright" data-bs-toggle="modal" data-bs-target="#moreInfoModal">
                    <i class="fa-regular fa-lightbulb"></i>
                </button>
            </div>
                
            <!-- Invoice Column -->
            <div class="col-sm-12 col-xl-5 p-5 invoice">
                <!-- Copy & Print Button -->
                <button id="copy-invoice" class="btn btn-primary copyBtn"><i class="fa-solid fa-copy"></i> + <i class="fa-solid fa-print"></i></button>
                <!-- Invoice Start -->
                <div id="invoice">
                    <div class="container">
                        <div class="d-flex justify-content-center row">
                            <div class="col-12">
                                <div class="p-3 bg-white rounded">
                                    <div class="row">
                                        <div class="col-sm-6">
                                            <h3 class="text-uppercase">Invoice Estimation</h3>
                                            <div class="billed"><span class="fw-bold">Requested by: </span><span class="ml-1" id="clientNameInvoice"></span></div>
                                            <div class="billed"><span class="fw-bold">Date: </span><span id="invoiceDate" class="ml-1"></span></div>
                                        </div>
                                        <div class="col-sm-6 text-end">
                                            <h4 class="mb-0"><i class="fa-brands fa-microsoft"></i> Microsoft</h4>
                                            <small>
                                                <span>Estimated by:</span><br>
                                                <span id="engineer"></span>
                                            </small>
                                        </div>
                                    </div>
                                    <div class="mt-3">
                                        <div class="table-responsive">
                                            <table class="table">
                                                <thead>
                                                    <tr>
                                                        <th style="width: 50%;">Subscription</th>
                                                        <th style="width: 15%;" class="text-end">Seats</th>
                                                        <th style="width: 10%;" class="text-end">Price</th>
                                                        <th style="width: 25%;" class="text-end">Total</th>
                                                    </tr>
                                                </thead>
                                                <!-- Table to append Invoice elements -->
                                                <tbody id="SubListInv">
                                                </tbody>
                                                <tfoot class="border-0">
                                                    <tr>
                                                        <td style="width: 50%;"></td>
                                                        <td style="width: 15%;" class="text-end"></td>
                                                        <td style="width: 10%;" class="text-end">Total</td>
                                                        <td id="invoiceTotal" style="width: 25%;" class="text-end"></td>
                                                    </tr>
                                                </tfoot>
                                            </table>
                                        </div>
                                    </div>
                                    <div class="text-end disclaimer">
                                        *This is only an estimated calculation, your final invoice may be different.
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Invoice End -->
            </div>
        </div>
    </div>




<!-- Modals -->

    <!-- Project Info  -->
    <div class="modal fade" id="moreInfoModal" tabindex="-1" aria-labelledby="moreInfoModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-centered">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="moreInfoModalLabel"><i class="fa-solid fa-people-pulling"></i> Get involved, build more fancy UX with us!</h5>
              
              <button type="button" class="btn-close m-0" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body" id="getCsOnlineUser-transcript">
                <ul>
                    <li>Abount Invoice Calculator
                        <ul>
                            <li>Build to simplify Invoice estimation to the minimum, therefore improve the efficiency of you, us, our Front Line Engineers</li>
                            <li>Contribute on <a href="https://github.com/radfullstack/InvoiceCalculator.git" target="_blank"><i class="fa-brands fa-github"></i> Github</a></li>
                        </ul>
                    </li>
                    <li>
                        Contact Information:
                        <ul><li>Design/UX Enquiries: <a href="mailto:katarzyna@programmingdepartment.co.uk">Katarzyna Bergier</a></li></ul>
                        <ul><li>Billing/Training Enquiries: <a href="mailto:anna@programmingdepartment.co.uk">Anna Walczak</a></li></ul>
                        <ul><li>Development Enquiries/Bug Reports: <a href="mailto:radoslaw@programmingdepartment.co.uk">Radoslaw Radecki</a></li></ul>
                    </li>
                </ul>
            </div>
          </div>
        </div>
      </div>


<!-- jQuery bundle -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
<!-- Bootstrap bundle -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>    

<!-- Custom scripts -->
<script type="text/javascript">
    // Lets get todays date
    var today = new Date(),
        todayFormatted =  today.getFullYear() + '-'+ ('0' + (today.getMonth()+1)).slice(-2) + '-'+ ('0' + today.getDate()).slice(-2);
        todayFormattedS =  ('0' + today.getDate()).slice(-2)  + '/' + ('0' + (today.getMonth()+1)).slice(-2) + '/'+ today.getFullYear();
        
    // Elements where we will be appending generated childs
        const SubscriptionList = document.getElementById("SubList"),
        SubscriptionListInvoice = document.getElementById("SubListInv"),
        InvoiceTotal = document.getElementById("invoiceTotal"),
        FLE = document.getElementById('engineer'),
        invoiceDate = document.getElementById('invoiceDate'),
        AddSubscriptionButton = document.getElementById('add-subscription'),
        clientName = document.getElementById("clientName"),
        clientNameInvoice = document.getElementById("clientNameInvoice");

    // Add engineer and estimation date to the invoice
        FLE.innerHTML = engineer;
        invoiceDate.innerHTML = todayFormattedS;

    // Read client info input and reflect it in the Invoice
        clientName.addEventListener("input", function () {
            clientNameInvoice.setAttribute('data-text', clientName.value);
            if ((clientName.value).length === 0) {
                clientNameInvoice.innerHTML = '';
            } else {
                clientNameInvoice.innerHTML = clientNameInvoice.getAttribute('data-text');
            }
        });

    // Add Subscription function
    AddSubscriptionButton.addEventListener("click", function () {

        // Subscription Elements
        const SubscriptionLi = document.createElement("li"),
        SubscriptionInfoRow = document.createElement("div"),
        SubscriptionColumn = document.createElement("div"),
        SubscriptionLabel = document.createElement("label"),
        SubscriptionInput = document.createElement("select"),
        SubscriptionOption = document.createElement("option"),
        SubscriptionPurchaseDateColumn = document.createElement("div"),
        SubscriptionPurchaseDateLabel = document.createElement("label"),
        SubscriptionPurchaseDateInput = document.createElement("input"),
        SubscriptionInitialSeatsColumn = document.createElement("div"),
        SubscriptionInitialSeatsLabel = document.createElement("label"),
        SubscriptionInitialSeatsInput = document.createElement("input"),
        SubscruptionRemovalColumn = document.createElement("div"),
        SubscruptionRemovalButton = document.createElement("button"),

        // Invoice Elements
        SubscriptionInvoiceTr = document.createElement("tr"),
        SubscriptionInvoiceCell = document.createElement("td"),
        SubscriptionInvoiceTable = document.createElement("table"),
        SubscriptionInvoiceTableTr = document.createElement("tr"),
        SubscriptionInvoiceSub = document.createElement("td"),
        SubscriptionInvoiceSubSeats = document.createElement("td"),
        SubscriptionInvoiceSubPrice = document.createElement("td"),
        SubscriptionInvoiceSubTotal = document.createElement("td"),

        // Subscription Change Elements
        SubscriptionChangeRow = document.createElement("div"),
        SubscriptionChangeColumn = document.createElement("div"),
        SubscriptionChangesList = document.createElement("ol"),
        LicenseChangeButtons = document.createElement("div"),
        AddSeatsButton = document.createElement("button"),
        RemoveSeatsButton = document.createElement("button");
        

        // Subscription Elements Attributes
        SubscriptionInvoiceTr.setAttribute("class", "d-none"),
        SubscriptionInfoRow.setAttribute("class", "row"),
        SubscriptionColumn.setAttribute("class", "col"),
        SubscriptionLabel.innerHTML = "Subscription:",
        SubscriptionInput.setAttribute("class", "form-select"),
        SubscriptionPurchaseDateColumn.setAttribute("class", "col"),
        SubscriptionPurchaseDateLabel.innerHTML = "Date Acquired:",
        SubscriptionPurchaseDateInput.setAttribute("class", "form-control"),
        SubscriptionPurchaseDateInput.setAttribute("type", "date"),
        SubscriptionPurchaseDateInput.setAttribute("value", todayFormatted),
        SubscriptionInitialSeatsColumn.setAttribute("class", "col"),
        SubscriptionInitialSeatsLabel.innerHTML = "Initial Seat Count:",
        SubscriptionInitialSeatsInput.setAttribute("class", "form-control"),
        SubscriptionInitialSeatsInput.setAttribute("placeholder", "77"),
        SubscruptionRemovalColumn.setAttribute("class", "col-auto"),
        SubscruptionRemovalButton.setAttribute("class", "btn btn-remove mt-3"),
        SubscruptionRemovalButton.innerHTML = '<i class="fa-solid fa-trash-can"></i>';
        SubscriptionOption.setAttribute("value", 0);
        SubscriptionOption.innerHTML = "Choose Subscription"
        SubscriptionInput.appendChild(SubscriptionOption);
        subscriptions.forEach((element) => {
                var SubscriptionOption = document.createElement("option");
                SubscriptionOption.setAttribute("value", element[1]);
                SubscriptionOption.innerHTML = element[0];
                SubscriptionInput.appendChild(SubscriptionOption);
        });

        // Invoice Elements Attributes
        SubscriptionInvoiceSubTotal.setAttribute("class", "subtotal text-end");
        SubscriptionInvoiceCell.setAttribute("colspan","4"),
        SubscriptionInvoiceSub.setAttribute("style","width:50%"),
        SubscriptionInvoiceSubSeats.setAttribute("style","width:15%"),
        SubscriptionInvoiceSubPrice.setAttribute("style","width:10%"),
        SubscriptionInvoiceSubTotal.setAttribute("style","width:25%"),
        SubscriptionInvoiceSubSeats.setAttribute("class","text-end"),
        SubscriptionInvoiceSubPrice.setAttribute("class","text-end"),
        SubscriptionInvoiceSubTotal.setAttribute("class","text-end subtotal"),
        SubscriptionInvoiceTable.classList.add("w-100")


        // Subscription Change Elements Attributes
        SubscriptionChangeRow.setAttribute("class", "row");
        SubscriptionChangeColumn.setAttribute("class", "offset-3 col-9 mt-3 ps-4");
        LicenseChangeButtons.setAttribute("class", "d-flex justify-content-end py-3");
        AddSeatsButton.setAttribute("class", "btn btn-remove-change");
        AddSeatsButton.innerHTML = '<i class="fa-solid fa-plus"></i>';
        RemoveSeatsButton.setAttribute("class", "btn btn-remove-change ms-2");
        SubscriptionChangesList.classList.add("ps-5");
        RemoveSeatsButton.innerHTML = '<i class="fa-solid fa-minus"></i>';
        
        SubscriptionInput.addEventListener("change", function () {
            SubscriptionInput.setAttribute('data-text', SubscriptionInput.value);
            if (SubscriptionInput.value === "0") {
                SubscriptionInvoiceTr.classList.add('d-none'),
                SubscriptionInvoiceSub.innerHTML = '';
                SubscriptionInvoiceSubPrice.innerHTML = '';
                SubscriptionInvoiceSubTotal.innerHTML = '0.00';
                countTotal();
            } else {
                SubscriptionInvoiceTr.classList.remove('d-none'),
                SubscriptionInvoiceSub.innerHTML = SubscriptionInput.options[SubscriptionInput.selectedIndex].text;
                SubscriptionInvoiceSubPrice.innerHTML = SubscriptionInput.getAttribute('data-text');
                SubscriptionInvoiceSubTotal.innerHTML = parseFloat(SubscriptionInvoiceSubSeats.innerHTML*SubscriptionInvoiceSubPrice.innerHTML).toFixed( 2 );
                countTotal();
        }});
        
        SubscriptionInitialSeatsInput.addEventListener("input", function () {
            SubscriptionInvoiceSubSeats.setAttribute('data-text', SubscriptionInitialSeatsInput.value);
            if ((SubscriptionInitialSeatsInput.value).length === 0) {
                SubscriptionInvoiceSubSeats.innerHTML = '';
                SubscriptionInvoiceSubTotal.innerHTML = '0.00';
            } else {
                SubscriptionInvoiceSubSeats.innerHTML = SubscriptionInvoiceSubSeats.getAttribute('data-text');
                SubscriptionInvoiceSubTotal.innerHTML = parseFloat(SubscriptionInvoiceSubSeats.innerHTML*SubscriptionInvoiceSubPrice.innerHTML).toFixed( 2 );
            }
           countTotal();
        });

        SubscriptionPurchaseDateInput.addEventListener("input", function () {
            SubscriptionPurchaseDateInput.setAttribute('data-text', SubscriptionPurchaseDateInput.value);
            if ((SubscriptionPurchaseDateInput.value).length === 0) {
                //scopeLiNote.innerHTML = '';
            } else {
                var date = new Date(SubscriptionPurchaseDateInput.getAttribute('data-text')),
                dateFormatted = ('0' + date.getDate()).slice(-2) + '/' + ('0' + (date.getMonth()+1)).slice(-2) + '/' + date.getFullYear();
                LastDayOfMonth = new Date(date.getFullYear(), ('0' + (date.getMonth()+1)).slice(-2), 0);
                const MonthAmountOfDays = ('0' + LastDayOfMonth.getDate()).slice(-2),
                DailyLicenseCost = SubscriptionInvoiceSubPrice.innerHTML/MonthAmountOfDays;
                
                console.log("Daily license cost for ", SubscriptionInput.options[SubscriptionInput.selectedIndex].text, "in", ('0' + (date.getMonth()+1)).slice(-2)+"("+MonthAmountOfDays+"days)/"+ date.getFullYear()+" is " + DailyLicenseCost);
            }
        });


        

        
        
        
        
        SubscriptionList.appendChild(SubscriptionLi);
        SubscriptionLi.appendChild(SubscriptionInfoRow);
        SubscriptionInfoRow.appendChild(SubscriptionColumn);
        SubscriptionColumn.appendChild(SubscriptionLabel);
        SubscriptionColumn.appendChild(SubscriptionInput)
        SubscriptionInfoRow.appendChild(SubscriptionPurchaseDateColumn);
        SubscriptionPurchaseDateColumn.appendChild(SubscriptionPurchaseDateLabel);
        SubscriptionPurchaseDateColumn.appendChild(SubscriptionPurchaseDateInput);
        SubscriptionInfoRow.appendChild(SubscriptionInitialSeatsColumn);
        SubscriptionInitialSeatsColumn.appendChild(SubscriptionInitialSeatsLabel);
        SubscriptionInitialSeatsColumn.appendChild(SubscriptionInitialSeatsInput);
        SubscriptionInfoRow.appendChild(SubscruptionRemovalColumn);
        SubscruptionRemovalColumn.appendChild(SubscruptionRemovalButton);
        SubscriptionLi.appendChild(SubscriptionChangeRow);
        SubscriptionChangeRow.appendChild(SubscriptionChangeColumn)
        SubscriptionChangeColumn.appendChild(SubscriptionChangesList)
        SubscriptionChangeColumn.appendChild(LicenseChangeButtons);
        LicenseChangeButtons.appendChild(AddSeatsButton);
        LicenseChangeButtons.appendChild(RemoveSeatsButton);


        // Append Invoice
        SubscriptionListInvoice.appendChild(SubscriptionInvoiceTr);
        SubscriptionInvoiceTr.appendChild(SubscriptionInvoiceCell);
        SubscriptionInvoiceCell.appendChild(SubscriptionInvoiceTable);
        SubscriptionInvoiceTable.appendChild(SubscriptionInvoiceTableTr);
        SubscriptionInvoiceTableTr.appendChild(SubscriptionInvoiceSub);
        SubscriptionInvoiceTableTr.appendChild(SubscriptionInvoiceSubSeats);
        SubscriptionInvoiceTableTr.appendChild(SubscriptionInvoiceSubPrice);
        SubscriptionInvoiceTableTr.appendChild(SubscriptionInvoiceSubTotal);



        SubscruptionRemovalButton.addEventListener("click", function () {      
            if (confirm("Delete subscription:\n" + SubscriptionInput.options[SubscriptionInput.selectedIndex].text + "?") == true) {
                SubscriptionLi.remove();
                SubscriptionInvoiceTr.remove();
                countTotal();
            }
        });
        
        // Create seat change Action: add / remove
        function ChangeSeats(Action) {
            // Change Elements
            const ChangeSeatsLi = document.createElement("li"),
            ChangeSeatsRow = document.createElement("div"),
            ChangeSeatsColumn = document.createElement("div"),
            ChangeSeatsLabel = document.createElement("label"),
            ChangeSeatsInput = document.createElement("input"),
            ChangeSeatsDateColumn = document.createElement("div"),
            ChangeSeatsDateLabel = document.createElement("label"),
            ChangeSeatsDateInput = document.createElement("input"),
            ChangeSeatsRemovalColumn = document.createElement("div"),
            ChangeSeatsRemovalButton = document.createElement("button"),

            // Invoice Elements
            ChangeSeatsIvoiceTr = document.createElement("tr"),
            ChangeSeatsIvoiceSub = document.createElement("td"),
            ChangeSeatsIvoiceSubSeats = document.createElement("td"),
            ChangeSeatsIvoiceSubPrice = document.createElement("td"),
            ChangeSeatsIvoiceSubTotal = document.createElement("td");

            // Change Attributes
            ChangeSeatsRow.setAttribute("class", "row mb-2");
            ChangeSeatsColumn.setAttribute("class", "col");
            ChangeSeatsLabel.innerHTML = Action + " seat count:"
            ChangeSeatsInput.setAttribute("class", "form-control");
            ChangeSeatsInput.setAttribute("placeholder", "77");
            ChangeSeatsDateColumn.setAttribute("class", "col");
            ChangeSeatsDateLabel.innerHTML = Action + " on:"
            ChangeSeatsDateInput.setAttribute("class", "form-control");
            ChangeSeatsDateInput.setAttribute("type", "date");
            ChangeSeatsDateInput.setAttribute("value", todayFormatted);
            ChangeSeatsRemovalColumn.setAttribute("class", "col-auto");
            ChangeSeatsRemovalButton.setAttribute("class", "btn btn-remove mt-3")
            ChangeSeatsRemovalButton.innerHTML = "<i class='fa-solid fa-trash-can'></i>"
            
            // Change Invoice Attributes
            ChangeSeatsIvoiceSub.setAttribute("style","width:50%"),
            ChangeSeatsIvoiceSubSeats.setAttribute("style","width:15%"),
            ChangeSeatsIvoiceSubPrice.setAttribute("style","width:10%"),
            ChangeSeatsIvoiceSubTotal.setAttribute("style","width:25%"),
            ChangeSeatsIvoiceSub.setAttribute("class","small"),
            ChangeSeatsIvoiceSubSeats.setAttribute("class","text-end"),
            ChangeSeatsIvoiceSubPrice.setAttribute("class","text-end"),
            ChangeSeatsIvoiceSubTotal.setAttribute("class","text-end subtotal"),

            // Add listener for change
            ChangeSeatsInput.addEventListener("input", function () {
                ChangeSeatsInput.setAttribute('data-text', ChangeSeatsInput.value);
                if ((ChangeSeatsInput.value).length === 0) {
                    ChangeSeatsIvoiceSubSeats.innerHTML = '';
                } else {
                    // Create purchase date
                    const dateOfPurchase = new Date(SubscriptionPurchaseDateInput.getAttribute('data-text')),
                        // Create date for the change
                        dateOfChange = new Date(ChangeSeatsDateInput.getAttribute('data-text')),
                        // Get last day to check number of days in the month
                        LastDayOfMonth = new Date(dateOfChange.getFullYear(), ('0' + (dateOfChange.getMonth()+1)).slice(-2), 0),
                        // Purchase Date Formatted for invoice
                        dateOfPurchaseFormatted = ('0' + dateOfPurchase.getDate()).slice(-2) + '/' + ('0' + (dateOfPurchase.getMonth()+1)).slice(-2) + '/' + dateOfPurchase.getFullYear(),
                        // Change Date Formatted for invoice
                        dateOfChangeFormatted = ('0' + dateOfChange.getDate()).slice(-2) + '/' + ('0' + (dateOfChange.getMonth()+1)).slice(-2) + '/' + dateOfChange.getFullYear(),
                        
                        // Calculate the time difference of two dates
                        DifferenceInTime = dateOfChange.getTime() - dateOfPurchase.getTime(),
                        // How much was used
                        UsedAmountOfDays = DifferenceInTime / (1000 * 3600 * 24),
                        // Set amount of days in a month
                        MonthAmountOfDays = ('0' + LastDayOfMonth.getDate()).slice(-2),
                        // Calculate daily cost for the license SubPrice/Amount of days in a month
                        DailyLicenseCost = SubscriptionInvoiceSubPrice.innerHTML/MonthAmountOfDays;

                        // Set Invoice Li with pricing
                        ChangeSeatsIvoiceSubSeats.innerHTML = ChangeSeatsInput.getAttribute('data-text');
                        // Change calculation depending on action type
                        if (Action == "add") {
                            ChangeSeatsIvoiceSubTotal.innerHTML = parseFloat(((MonthAmountOfDays - UsedAmountOfDays)*DailyLicenseCost)*ChangeSeatsInput.value).toFixed(2);
                        } else if (Action == "remove") {
                            ChangeSeatsIvoiceSubTotal.innerHTML = parseFloat((UsedAmountOfDays*DailyLicenseCost)*(-ChangeSeatsInput.value)).toFixed(2);
                        }
                        
                        // Just to get some idea
                        console.log(
                            "Increase ", 
                            ChangeSeatsInput.value,
                            "seats on", dateOfChangeFormatted
                        )
                    // Recalculate the count
                    countTotal();
                    ChangeSeatsIvoiceSub.innerHTML = InvoiceActionComment + dateOfChangeFormatted;

                }
            });

            // If Action Add or Remove
            if (Action == "add") {
                InvoiceActionComment = "Increase seats from ";
            } else if (Action == "remove") {
                InvoiceActionComment = "Decrease seats from "
            }

            // Add listener for Date Change
            ChangeSeatsDateInput.addEventListener("input", function () {
                ChangeSeatsDateInput.setAttribute('data-text', ChangeSeatsDateInput.value);
                if ((ChangeSeatsDateInput.value).length === 0) {
                    ChangeSeatsIvoiceSubTotal.innerHTML = '';
                } else {
                    const dateOfPurchase = new Date(SubscriptionPurchaseDateInput.getAttribute('data-text')),
                        dateOfChange = new Date(ChangeSeatsDateInput.getAttribute('data-text')),
                        LastDayOfMonth = new Date(dateOfChange.getFullYear(), ('0' + (dateOfChange.getMonth()+1)).slice(-2), 0),
                        dateOfPurchaseFormatted = ('0' + dateOfPurchase.getDate()).slice(-2) + '/' + ('0' + (dateOfPurchase.getMonth()+1)).slice(-2) + '/' + dateOfPurchase.getFullYear(),
                        dateOfChangeFormatted = ('0' + dateOfChange.getDate()).slice(-2) + '/' + ('0' + (dateOfChange.getMonth()+1)).slice(-2) + '/' + dateOfChange.getFullYear(),
                        
                        // To calculate the time difference of two dates
                        Difference_In_Time = dateOfChange.getTime() - dateOfPurchase.getTime();
                        
                    const UsedAmountOfDays = Difference_In_Time / (1000 * 3600 * 24),
                          MonthAmountOfDays = ('0' + LastDayOfMonth.getDate()).slice(-2),
                          DailyLicenseCost = SubscriptionInvoiceSubPrice.innerHTML/MonthAmountOfDays;
                    
                    ChangeSeatsIvoiceSub.innerHTML = InvoiceActionComment + dateOfChangeFormatted;
                    if (Action == "add") {
                        ChangeSeatsIvoiceSubTotal.innerHTML = parseFloat(((MonthAmountOfDays - UsedAmountOfDays)*DailyLicenseCost)*ChangeSeatsInput.value).toFixed(2);
                    } else if (Action == "remove") {
                        ChangeSeatsIvoiceSubTotal.innerHTML = parseFloat(-Math.abs(((MonthAmountOfDays - UsedAmountOfDays)*DailyLicenseCost)*ChangeSeatsInput.value)).toFixed(2);
                    }
                    countTotal();
                    console.log(
                        "Increase ", 
                        ChangeSeatsInput.value,
                        "seats on", dateOfChangeFormatted,
                        "cost", parseFloat(UsedAmountOfDays*DailyLicenseCost).toFixed(2)
                    )
                }
            });

            // Add listener for Removal Function
            ChangeSeatsRemovalButton.addEventListener("click", function () {
                if (confirm("Delete change number #" + (Array.prototype.indexOf.call(ChangeSeatsLi.parentNode.children, ChangeSeatsLi)+1) + " for subscription:\n" + SubscriptionInput.options[SubscriptionInput.selectedIndex].text + "?") == true) {
                    ChangeSeatsLi.remove();
                    ChangeSeatsIvoiceTr.remove();
                    countTotal();
                }
            });

            // Append Subscription Change
            SubscriptionChangesList.appendChild(ChangeSeatsLi);
            ChangeSeatsLi.appendChild(ChangeSeatsRow);
            ChangeSeatsRow.appendChild(ChangeSeatsDateColumn);
            ChangeSeatsDateColumn.appendChild(ChangeSeatsDateLabel);
            ChangeSeatsDateColumn.appendChild(ChangeSeatsDateInput);
            ChangeSeatsRow.appendChild(ChangeSeatsColumn);
            ChangeSeatsColumn.appendChild(ChangeSeatsLabel);
            ChangeSeatsColumn.appendChild(ChangeSeatsInput);
            ChangeSeatsRow.appendChild(ChangeSeatsRemovalColumn);
            ChangeSeatsRemovalColumn.appendChild(ChangeSeatsRemovalButton);

            // Append Invoice
            SubscriptionInvoiceTable.appendChild(ChangeSeatsIvoiceTr);
            ChangeSeatsIvoiceTr.appendChild(ChangeSeatsIvoiceSub);
            ChangeSeatsIvoiceTr.appendChild(ChangeSeatsIvoiceSubSeats);
            ChangeSeatsIvoiceTr.appendChild(ChangeSeatsIvoiceSubPrice);
            ChangeSeatsIvoiceTr.appendChild(ChangeSeatsIvoiceSubTotal);
        };
        


        function countTotal() {
            SubTotals = document.getElementsByClassName("subtotal");
                SubTotalCount=[];
                for (var i = 0; i < SubTotals.length; i++) {
                    SubTotalCount.push(parseFloat(SubTotals.item(i).innerHTML, 2))
                    console.log(SubTotalCount);
                }
                Total = SubTotalCount.reduce(function(a, b) { return a + b; }, 0).toFixed( 2 );
                if(isNaN(Total)) {
                    Total = "0.00"
                }

                InvoiceTotal.innerHTML = Total;
        }
        
        AddSeatsButton.addEventListener("click", function () {
            ChangeSeats("add")
        });
        RemoveSeatsButton.addEventListener("click", function () {
            ChangeSeats("remove")
        });
    });
    AddSubscriptionButton.click();                    














    // Copy Invoice function
    copyAndPrintText("copy-invoice","invoice");

    // Copy text function
    function copyAndPrintText(btnID, divID) {
        const button = document.getElementById(btnID),
        content = document.getElementById(divID);

        button.addEventListener("click", function () {
            
            if (window.getSelection) {
                var range = document.createRange();
                window.getSelection().removeAllRanges();
                range.selectNode(content);
                window.getSelection().addRange(range);
                document.execCommand("copy");
                window.getSelection().removeAllRanges();
            }

            var last = this.innerHTML;
            if (last == '<i class="fa-solid fa-copy"></i> + <i class="fa-solid fa-print"></i>') {
                this.classList.add("btn-success");
                this.classList.remove("btn-primary");
                this.innerHTML = '<i class="fa-solid fa-check"></i>';
                setTimeout(function () {
                    this.classList.add("btn-primary");
                    this.classList.remove("btn-success");
                    this.innerHTML = last;
                }.bind(this), 1000);
            }
            const formPanel = document.getElementById("form-panel");
            formPanel.classList.add("d-none");
            button.classList.add("d-none");
            window.print();
            formPanel.classList.remove("d-none");
            button.classList.remove("d-none");            
        })
    }
</script>
</body>
</html>